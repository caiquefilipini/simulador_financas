<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Simples de Input Numérico</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 5px;
        }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            width: 200px;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 4px;
        }
        .input-log {
            margin-top: 20px;
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            font-family: monospace;
            background-color: #f5f5f5;
        }
    </style>
</head>
<body>
    <h1>Teste de Input Numérico</h1>
    
    <div class="container">
        <div class="input-group">
            <label for="numericInput">Digite um número (ex: -123,45):</label>
            <input type="text" id="numericInput" placeholder="Ex: -123,45">
        </div>
        
        <div class="result">
            <div><strong>Valor digitado:</strong> <span id="rawValue"></span></div>
            <div><strong>Valor processado:</strong> <span id="processedValue"></span></div>
            <div><strong>Tipo:</strong> <span id="valueType"></span></div>
            <div><strong>É válido?</strong> <span id="isValid"></span></div>
        </div>
        
        <div class="input-log" id="logArea">
            <!-- Log de eventos será exibido aqui -->
        </div>
    </div>

    <script>
        // Elementos do DOM
        const numericInput = document.getElementById('numericInput');
        const rawValue = document.getElementById('rawValue');
        const processedValue = document.getElementById('processedValue');
        const valueType = document.getElementById('valueType');
        const isValid = document.getElementById('isValid');
        const logArea = document.getElementById('logArea');
        
        // Função para adicionar log
        function addLog(message) {
            const logEntry = document.createElement('div');
            logEntry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        // Evento de input
        numericInput.addEventListener('input', function(e) {
            // Registra o valor original
            const originalValue = e.target.value;
            rawValue.textContent = originalValue;
            addLog(`Valor original: "${originalValue}"`);
            
            // Expressão regular para validar
            const regex = /^-?\d*[.,]?\d*$/;
            const isValidValue = regex.test(originalValue) || originalValue === '-' || originalValue === '';
            isValid.textContent = isValidValue ? "Sim" : "Não";
            
            // Se não for válido, corrigir o valor
            if (!isValidValue) {
                // Substitui caracteres inválidos
                let cleanValue = originalValue;
                
                // Método 1: Usando replace com regex
                cleanValue = cleanValue.replace(/[^\d.,-]/g, '');
                addLog(`Após remover caracteres inválidos: "${cleanValue}"`);
                
                // Método 2: Processamento manual para garantir formato correto
                let finalValue = '';
                let hasNegativeSign = false;
                let hasDecimalPoint = false;
                
                for (let i = 0; i < cleanValue.length; i++) {
                    const char = cleanValue[i];
                    
                    if (char === '-' && i === 0 && !hasNegativeSign) {
                        // Permite sinal negativo apenas no início
                        finalValue += char;
                        hasNegativeSign = true;
                    } else if ((char === '.' || char === ',') && !hasDecimalPoint) {
                        // Permite apenas um separador decimal
                        finalValue += ','; // Uniformiza para vírgula na exibição
                        hasDecimalPoint = true;
                    } else if (char >= '0' && char <= '9') {
                        // Permite dígitos
                        finalValue += char;
                    }
                }
                
                addLog(`Valor corrigido: "${finalValue}"`);
                e.target.value = finalValue;
                rawValue.textContent = finalValue;
            }
            
            // Processa o valor para cálculos (converte vírgula para ponto)
            let valueForCalculation = e.target.value.replace(',', '.');
            
            // Converte para número se possível
            let numericValue;
            if (valueForCalculation === '' || valueForCalculation === '-') {
                numericValue = 0;
                valueType.textContent = "Número (padrão = 0)";
            } else {
                numericValue = parseFloat(valueForCalculation);
                if (isNaN(numericValue)) {
                    valueType.textContent = "NaN (não é um número)";
                } else {
                    valueType.textContent = `Número (${typeof numericValue})`;
                }
            }
            
            processedValue.textContent = numericValue;
            addLog(`Valor processado: ${numericValue} (${typeof numericValue})`);
        });
    </script>
</body>
</html>